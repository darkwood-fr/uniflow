#!/bin/sh

if [ "$1" = "ssh" ]; then

ssh admin@darkwood.fr

else

ssh admin@darkwood.fr << CMD

# deploy back
cd /var/www/uniflow.io

#sudo service mysql restart
#sudo service varnish restart
#sudo service nginx restart
#sudo service redis restart
#redis-cli flushall

git pull
(cd back;SYMFONY_ENV=prod composer install --optimize-autoloader)
(cd back;php bin/console cache:clear  --no-debug)
(cd back;php bin/console doctrine:schema:update --force)

CMD

# deploy front
(cd ../front;yarn install)
(cd ../front;yarn build)
scp public/dist/js/bundle.js admin@darkwood.fr:/var/www/uniflow.io/back/public/dist/js/bundle.js

# deploy bash
(cd ../bash;yarn install)
(cd ../bash;yarn build)
scp public/dist/js/bash.js admin@darkwood.fr:/var/www/uniflow.io/back/public/dist/js/bash.js

fi
