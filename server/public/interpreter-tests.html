<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Interpreter tests</title>
</head>
<body>
<div id="output"></div>
<script src="js/acorn_interpreter.js"></script>
<script>
    (function () {
        let interpreter = new Interpreter('', (interpreter, scope) => {
            let initConsole = function () {
                let consoleObj = interpreter.createObject(interpreter.OBJECT);
                interpreter.setProperty(scope, 'console', consoleObj);

                let wrapper = function (value) {
                    let nativeObj = interpreter.pseudoToNative(value);
                    return interpreter.createPrimitive(console.log(nativeObj));
                };
                interpreter.setProperty(consoleObj, 'log', interpreter.createNativeFunction(wrapper));
            };
            initConsole.call(interpreter);

            let wrapper = function (href, callback) {
                let req = new XMLHttpRequest();
                req.open('GET', href, true);
                req.onreadystatechange = function () {
                    if (req.readyState === 4 && req.status === 200) {
                        callback(req.responseText);
                    }
                };
                req.send(null);
            };
            interpreter.setProperty(scope, 'getXhr', interpreter.createAsyncFunction(wrapper));
        });

        interpreter.appendCode('console.log(getXhr(\'https://neil.fraser.name/software/JS-Interpreter/demos/async.txt\'))')

        interpreter.run()
        setTimeout(function() {
            interpreter.run()

        }, 1000)
    })()
</script>
</body>
</html>